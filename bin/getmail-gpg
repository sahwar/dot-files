#!/usr/bin/env zsh
# getmail wrapper that inputs password stored in a gpg encrypted file.

zmodload zsh/zpty

zpty PTY command getmail -r ~/.mail-accounts/$EMAIL/getmailrc
zpty -r PTY tmp "*Enter password*:"
zpty -w PTY $(gpg --batch -q --decrypt ~/.mail-accounts/$EMAIL/password.gpg)
while zpty -r PTY tmp; do
	print -n $tmp
done
zpty -d PTY
